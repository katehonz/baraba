# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üöÄ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞

**Baraba –µ —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–∞–Ω–∞ –æ—Ç Nim –ø–æ–ª–∏–≥–ª–æ—Ç –º–∏–∫—Ä–æ—Å—ä—Ä–≤–∏—Å–∏ –∫—ä–º Elixir Phoenix umbrella –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.** –°–∏—Å—Ç–µ–º–∞—Ç–∞ –µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–∞–Ω–∞ –¥–∞ –±—ä–¥–µ –º–∞—â–∞–±–∏—Ä—É–µ–º–∞, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–∞ –∏ –ª–µ—Å–Ω–∞ –∑–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞ —Å –µ–¥–∏–Ω–µ–Ω Elixir ecosystem.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞

### 1. Elixir Phoenix Umbrella (baraba_umbrella)

#### –û—Å–Ω–æ–≤–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (apps/baraba_umbrella)
–¢–æ–≤–∞ –µ —è–¥—Ä–æ—Ç–æ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞, —Å—ä–¥—ä—Ä–∂–∞—â–æ **–ø—ä–ª–Ω–æ –º–∏–≥—Ä–∏—Ä–∞–Ω–∞ –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞ –æ—Ç Nim**:
- **Ecto Schemas**: –í—Å–∏—á–∫–∏ –±–∏–∑–Ω–µ—Å –æ–±–µ–∫—Ç–∏ + –Ω–æ–≤–∏ –º–æ–¥—É–ª–∏
- **Context Modules**: –û–±–µ–¥–∏–Ω–µ–Ω–∞ –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞ –∑–∞ —Å—á–µ—Ç–æ–≤–æ–¥—Å—Ç–≤–æ
- **Database**: PostgreSQL –≤—Ä—ä–∑–∫–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (20+ –º–∏–≥—Ä–∞—Ü–∏–∏)

–ö–ª—é—á–æ–≤–∏ –º–æ–¥—É–ª–∏:
- `BarabaUmbrella.Accounting` - –û—Å–Ω–æ–≤–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞ —Å—á–µ—Ç–æ–≤–æ–¥–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `BarabaUmbrella.Companies` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ñ–∏—Ä–º–∏
- `BarabaUmbrella.Accounts` - –°—á–µ—Ç–æ–≤–æ–¥–Ω–∞ –ø–ª–∞–Ω
- `BarabaUmbrella.JournalEntries` - –ñ—É—Ä–Ω–∞–ª–Ω–∏ –∑–∞–ø–∏—Å–∏
- `BarabaUmbrella.AccountingPeriods` - üÜï –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—á–µ—Ç–æ–≤–æ–¥–Ω–∏ –ø–µ—Ä–∏–æ–¥–∏
- `BarabaUmbrella.FixedAssets` - üÜï –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞
- `BarabaUmbrella.Products` - üÜï –ü—Ä–æ–¥—É–∫—Ç–∏ –∏ —Å–∫–ª–∞–¥
- `BarabaUmbrella.VATReturns` - üÜï –î–î–° –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–∏

#### Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (apps/baraba_umbrella_web)
REST API —Å–ª–æ–π —Å:
- **Controllers**: JSON API endpoints
- **Views**: JSON serialization
- **Routes**: API routing –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ö–ª—é—á–æ–≤–∏ –µ–Ω–¥–ø–æ–π–Ω—Ç–∏:
- `/api/companies` - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ —Ñ–∏—Ä–º–∏
- `/api/companies/:id/accounts` - –°–º–µ—Ç–∫–∏ –Ω–∞ —Ñ–∏—Ä–º–∞
- `/api/companies/:id/counterparts` - –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∏
- `/api/companies/:id/journal-entries` - –°—á–µ—Ç–æ–≤–æ–¥–Ω–∏ –∑–∞–ø–∏—Å–∏

#### SAFT Service (apps/saft)
–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–∞ —É—Å–ª—É–≥–∞ –∑–∞:
- **SAF-T XML –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** –∑–∞ –ù–ê–ü
- **Bulgarian tax compliance**
- **Plug/Cowboy —Å—ä—Ä–≤—ä—Ä** –Ω–∞ –ø–æ—Ä—Ç 5006

### 2. React Frontend (frontend/)

–ú–æ–¥–µ—Ä–µ–Ω single-page application:
- **TypeScript** –∑–∞ type safety
- **Chakra UI** –∑–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
- **Vite** –∑–∞ bundling –∏ development
- **React Router** –∑–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- **i18next** –∑–∞ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞–ª–∏–∑–∞—Ü–∏—è

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
src/
‚îú‚îÄ‚îÄ components/     # Reusable UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
‚îú‚îÄ‚îÄ pages/         # Page –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
‚îú‚îÄ‚îÄ api/           # API client –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ types/         # TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏
‚îú‚îÄ‚îÄ contexts/      # React contexts
‚îî‚îÄ‚îÄ locales/       # –ü—Ä–µ–≤–æ–¥–∏
```

### 3. Jasper Service (jasper_service/)

Java Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞:
- **PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** —á—Ä–µ–∑ Jasper Reports
- **–§–∏–Ω–∞–Ω—Å–æ–≤–∏ –æ—Ç—á–µ—Ç–∏**
- **Invoice PDF-–∏**
- **Custom report templates**

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- Spring Boot
- Jasper Reports
- PostgreSQL JDBC
- Maven

## –ë–∞–∑–∞ –¥–∞–Ω–Ω–∏

### –°—Ö–µ–º–∞ (üîÑ –ü—ä–ª–Ω–æ –º–∏–≥—Ä–∏—Ä–∞–Ω–∞ –æ—Ç Nim ORM –∫—ä–º Ecto)

–û—Å–Ω–æ–≤–Ω–∏ —Ç–∞–±–ª–∏—Ü–∏ (–º–∏–≥—Ä–∏—Ä–∞–Ω–∏ + –Ω–æ–≤–∏):
```sql
companies              -- –§–∏—Ä–º–∏
accounts              -- –°–º–µ—Ç–∫–æ–ø–ª–∞–Ω
counterparts          -- –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∏
vat_rates             -- –î–î–° —Å—Ç–∞–≤–∫–∏
journal_entries       -- –ñ—É—Ä–Ω–∞–ª–Ω–∏ –∑–∞–ø–∏—Å–∏ (header)
entry_lines           -- –†–µ–¥–æ–≤–µ –æ—Ç –∂—É—Ä–Ω–∞–ª–µ–Ω –∑–∞–ø–∏—Å
users                 -- –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
fixed_assets          -- üÜï –û—Å–Ω–æ–≤–Ω–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞
fixed_asset_categories-- üÜï –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –û–°
products              -- üÜï –ü—Ä–æ–¥—É–∫—Ç–∏
stock_levels          -- üÜï –°–∫–ª–∞–¥–æ–≤–∏ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç–∏
stock_movements       -- üÜï –î–≤–∏–∂–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ–∫–∏
vat_entries           -- üÜï –î–î–° —Å—ä–±–∏—Ç–∏—è
vat_returns           -- üÜï –î–î–° –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–∏
currencies            -- üÜï –í–∞–ª—É—Ç–∏
exchange_rates        -- üÜï –í–∞–ª—É—Ç–Ω–∏ –∫—É—Ä—Å–æ–≤–µ
```

### –†–µ–ª–∞—Ü–∏–∏ (–ú–∏–≥—Ä–∏—Ä–∞–Ω–∏ + –ù–æ–≤–∏)

```
companies 1:N accounts
companies 1:N counterparts
companies 1:N journal_entries
companies 1:N vat_rates
companies 1:N fixed_assets           -- üÜï
companies 1:N products               -- üÜï
companies 1:N vat_returns             -- üÜï

journal_entries 1:N entry_lines
journal_entries 1:N vat_entries       -- üÜï
entry_lines N:1 accounts
entry_lines N:1 counterparts
entry_lines N:1 products              -- üÜï

products 1:N stock_levels            -- üÜï
products 1:N stock_movements         -- üÜï
fixed_assets N:1 fixed_asset_categories-- üÜï
currencies 1:N exchange_rates         -- üÜï
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏

–ú–∏–≥—Ä–∞—Ü–∏–∏—Ç–µ —Å–µ –Ω–∞–º–∏—Ä–∞—Ç –≤:
```
apps/baraba_umbrella/priv/repo/migrations/
```

## API –î–∏–∑–∞–π–Ω

### RESTful –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏

- `GET /api/resource` - List –≤—Å–∏—á–∫–∏ —Ä–µ—Å—É—Ä—Å–∏
- `GET /api/resource/:id` - –í–∑–µ–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–µ–Ω —Ä–µ—Å—É—Ä—Å
- `POST /api/resource` - –°—ä–∑–¥–∞–π –Ω–æ–≤ —Ä–µ—Å—É—Ä—Å
- `PUT /api/resource/:id` - –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–π —Ä–µ—Å—É—Ä—Å
- `DELETE /api/resource/:id` - –ò–∑—Ç—Ä–∏–π —Ä–µ—Å—É—Ä—Å

### Response —Ñ–æ—Ä–º–∞—Ç

```json
{
  "data": {
    "id": "uuid",
    "type": "company",
    "attributes": {
      "name": "–§–∏—Ä–º–∞ –û–û–î",
      "vat_number": "BG123456789"
    }
  },
  "meta": {
    "timestamp": "2024-01-15T10:30:00Z"
  }
}
```

### Error handling

```json
{
  "errors": [
    {
      "code": "validation_error",
      "message": "Invalid VAT number format",
      "field": "vat_number"
    }
  ]
}
```

## –°–∏–≥—É—Ä–Ω–æ—Å—Ç

### Authentication & Authorization
- JWT —Ç–æ–∫–µ–Ω–∏ –∑–∞ authentication
- –†–æ–ª–∏: admin, accountant, viewer
- Company-scoped –¥–æ—Å—Ç—ä–ø

### Data Validation
- Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ Ecto changesets
- Frontend –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ React forms
- SQL injection –∑–∞—â–∏—Ç–∞ —á—Ä–µ–∑ Ecto

### HTTPS & Security Headers
- HTTPS –∑–∞ –ø—Ä–æ–¥—É–∫—Ü–∏—è
- CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- Rate limiting
- SQL injection –∑–∞—â–∏—Ç–∞

## Performance

### Database –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ò–Ω–¥–µ–∫—Å–∏ –∑–∞ —á–µ—Å—Ç–æ –∑–∞—è–≤—è–≤–∞–Ω–∏ –ø–æ–ª–µ—Ç–∞
- Database pooling (10 connections)
- Query optimization –∑–∞ –≥–æ–ª–µ–º–∏ datasets

### Caching
- ETS –∑–∞ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–µ–Ω cache
- Redis –∑–∞ long-term caching (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)
- CDN –∑–∞ static assets

### Scalability
- Stateless API –¥–∏–∑–∞–π–Ω
- Horizontal scaling –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç
- Load balancer –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç

## Monitoring & Logging

### Logging
- Structured logging —Å JSON —Ñ–æ—Ä–º–∞—Ç
- Log levels: debug, info, warn, error
- Centralized logging (ELK stack –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç)

### Metrics
- Phoenix telemetry
- Database query performance
- Request/response metrics
- Error rates

### Health Checks
- `/api/health` endpoint
- Database connectivity
- Service dependencies —Å—Ç–∞—Ç—É—Å

## Deployment

### Docker Configuration

Multi-stage Docker builds:
```dockerfile
# Phoenix app
FROM elixir:1.15-alpine AS builder
# Production image
FROM elixir:1.15-alpine AS runtime
```

### Environment-specific –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- `config/dev.exs` - Development –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `config/prod.exs` - Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `config/runtime.exs` - Runtime –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### CI/CD Pipeline

GitHub Actions –ø—Ä–∏–º–µ—Ä:
```yaml
name: CI/CD
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Elixir
        uses: erlef/setup-beam@v1
      - name: Install dependencies
        run: mix deps.get
      - name: Run tests
        run: mix test
```

## Backup & Recovery

### Database Backup
```bash
# Daily backup
pg_dump jesterac > backup_$(date +%Y%m%d).sql

# Automated script
0 2 * * * /path/to/backup_script.sh
```

### Disaster Recovery
- Database replication
- Application snapshots
- Recovery time objective: < 1 —á–∞—Å
- Recovery point objective: < 15 –º–∏–Ω—É—Ç–∏

## Development Workflow

### Git Workflow
- Main branch: `main`
- Feature branches: `feature/feature-name`
- Pull requests –∑–∞ –≤—Å–∏—á–∫–∏ –ø—Ä–æ–º–µ–Ω–∏
- Automated testing

### Code Quality
- `mix format` –∑–∞ Elixir code
- ESLint/Prettier –∑–∞ TypeScript
- Static analysis tools
- Code review –ø—Ä–æ—Ü–µ—Å

### Testing Strategy
- Unit —Ç–µ—Å—Ç–æ–≤–µ (>90% coverage)
- Integration —Ç–µ—Å—Ç–æ–≤–µ
- E2E —Ç–µ—Å—Ç–æ–≤–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)
- Performance —Ç–µ—Å—Ç–æ–≤–µ