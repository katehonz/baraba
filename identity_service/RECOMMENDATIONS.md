# Препоръки за Identity Service

## 1. Рефакториране и Структура на кода
- **Проблем:** В момента `src/identity_service.nim` съдържа цялата логика (рутиране, контролери, бизнес логика), което го прави труден за четене и поддръжка. Папката `src/routes/` съдържа неизползван код.
- **Решение:** 
  - Изместване на дефинициите на пътищата (routes) в отделни модули в `src/routes/` (напр. `auth_routes.nim`, `user_routes.nim`).
  - Използване на `jester` patterns за включване на под-рутери.
  - Преместване на бизнес логиката (създаване на user, hash-ване на пароли) изцяло в `services/`.

## 2. Конфигурация
- **Проблем:** Портът `5002` е hardcoded.
- **Решение:** Използване на `std/os` и `getEnv` за четене на порт от средата (напр. `PORT`), с fallback към 5002. Това е критично за Docker/Kubernetes деплоймънт.

## 3. Сигурност
- **Валидация на входни данни:** Добавяне на проверки за валиден email формат и по-силни пароли (Regex).
- **Rate Limiting:** Добавяне на защита срещу brute-force атаки на `/api/auth/login`.

## 4. Логване (Logging)
- **Проблем:** Използва се `echo` или липсва логване.
- **Решение:** Интегриране на библиотека за логване (напр. `chronicles` или `rollinglog`), за да се следят грешки и достъп в продукционна среда.

## 5. Тестване
- **Проблем:** Липсват автоматизирани тестове.
- **Решение:** Написване на unit тестове за `services/auth.nim` и интеграционни тестове за API ендпойнтите.
